# ═══════════════════════════════════════════════════════════════════
# Atlas Production Environment Manifest
# ═══════════════════════════════════════════════════════════════════
#
# Complete inventory of every environment variable Atlas reads.
# Copy to .env for production deployment. All feature flags document
# their default behavior and the pattern used (opt-in vs opt-out).
#
# Pattern key:
#   opt-out (kill switch) = ON by default, set =false to disable
#   opt-in               = OFF by default, set =true to enable
#
# Generated: 2026-02-18 (Production Hardening sprint)
# ═══════════════════════════════════════════════════════════════════

# ─── REQUIRED ─────────────────────────────────────────────────────

# Telegram Bot Token (from @BotFather)
TELEGRAM_BOT_TOKEN=

# Telegram User IDs allowed to interact (comma-separated)
TELEGRAM_ALLOWED_USERS=

# Notion Integration Token (https://www.notion.so/my-integrations)
NOTION_API_KEY=

# Anthropic API Key (Claude — primary LLM)
ANTHROPIC_API_KEY=

# ─── API KEYS (OPTIONAL) ─────────────────────────────────────────

# OpenAI API Key (voice transcription, GPT models)
# OPENAI_API_KEY=

# Google/Gemini API Key (web search grounding, research agent, media)
# GEMINI_API_KEY=

# OpenRouter API Key (fallback aggregator when direct APIs unavailable)
# OPENROUTER_API_KEY=

# ─── RUNTIME MODE ────────────────────────────────────────────────

# Atlas Mode: development | production
# Production CANNOT run with ENABLE_FALLBACKS=true (process.exit guard)
ATLAS_MODE=production

# Enable fallbacks for graceful degradation (MUST be false in production)
# When false: classification failures throw, research agents hard-fail
ENABLE_FALLBACKS=false

# Auto-log errors to Dev Pipeline (default: true, opt-out)
AUTO_LOG_ERRORS=true

# ─── COGNITIVE ROUTER ────────────────────────────────────────────

# Enable cognitive router (opt-out — default ON)
# USE_COGNITIVE_ROUTER=false

# Maximum concurrent workers (default: 5)
COGNITIVE_MAX_CONCURRENT_WORKERS=5

# Prefer direct API over OpenRouter (default: true, opt-out)
# COGNITIVE_PREFER_DIRECT_API=false

# Enable OpenRouter fallback (default: true, opt-out)
# COGNITIVE_OPENROUTER_FALLBACK=false

# Cost threshold for checkpoint (USD, default: 0.50)
COGNITIVE_COST_CHECKPOINT_THRESHOLD=0.50

# Circuit breaker max retries (default: 3)
COGNITIVE_MAX_RETRIES=3

# Cognitive Router database IDs (defaults baked into config/cognitive.ts)
# NOTION_TOKEN_LEDGER_DB=6ec84319-8867-4aee-b55d-defe921c9f7b
# NOTION_WORKER_RESULTS_DB=d886ee70-ab25-4388-acff-4314c77573b1

# PromptManager — Notion-tunable prompts (System, Voice, Classifier, Drafter, Research)
NOTION_PROMPTS_DB_ID=2fc780a78eef8196b29bdb4a6adfdc27

# ─── CONVERSATION UX (bot.ts) ───────────────────────────────────

# Conversational UX mode (opt-out — default ON)
# ATLAS_CONVERSATIONAL_UX=false

# Content confirmation keyboards (opt-out — default ON)
# ATLAS_CONTENT_CONFIRM=false

# ─── FEATURE FLAGS: SKILL SYSTEM ────────────────────────────────
# Source: apps/telegram/src/config/features.ts

# Phase 1: Action Logging — logs actions with intent hashes (opt-out — default ON)
# ATLAS_SKILL_LOGGING=false

# Phase 2: Skill Execution — executes matched skills (opt-out — default ON)
# ATLAS_SKILL_EXECUTION=false

# Phase 2: Hot Reload — watches skill files for changes (opt-in — default OFF)
# ATLAS_SKILL_HOT_RELOAD=true

# Phase 3: Pattern Detection — auto-proposes skills from patterns (opt-in — default OFF)
# ATLAS_PATTERN_DETECTION=true

# Phase 3: Auto-deploy Tier 0 — read-only skills deploy without approval (opt-in — default OFF)
# ATLAS_AUTO_DEPLOY_TIER0=true

# Phase 4: Skill Composition — skills can invoke other skills (opt-in — default OFF)
# ATLAS_SKILL_COMPOSITION=true

# ─── FEATURE FLAGS: AUTONOMOUS REPAIR ───────────────────────────
# All default ON (opt-out kill switches). Uncomment to DISABLE.

# Zone classifier — routes operations through permission zones
# ATLAS_ZONE_CLASSIFIER=false

# Swarm dispatch — spawns Claude Code sessions for autonomous fixes
# ATLAS_SWARM_DISPATCH=false

# Self-improvement listener — polls Feed 2.0 for auto-repair entries
# ATLAS_SELF_IMPROVEMENT_LISTENER=false

# API swarm dispatch — uses Anthropic SDK directly instead of CLI
# ATLAS_API_SWARM=false

# Health alert producer — periodic health checks → Feed 2.0 Alerts
# ATLAS_HEALTH_ALERT_PRODUCER=false

# Approval producer — Tier 2 skills create Approval cards (fail-closed)
# ATLAS_APPROVAL_PRODUCER=false

# Review producer — completed research creates Review cards (fail-open)
# ATLAS_REVIEW_PRODUCER=false

# ─── FEATURE FLAGS: TRIAGE INTELLIGENCE ─────────────────────────
# All default ON (core features). Uncomment to DISABLE.

# Unified Haiku triage skill (always-on since handler refactor 2026-02-09)
# ATLAS_TRIAGE_SKILL=false

# Low confidence → capture instead of clarify (Bug #3 fix)
# ATLAS_LOW_CONFIDENCE_CAPTURE=false

# Multi-intent parsing for compound messages (Bug #6 fix)
# ATLAS_MULTI_INTENT=false

# ─── FEATURE FLAGS: BUG FIXES ───────────────────────────────────
# All default ON (core fixes). Uncomment to DISABLE.

# Pending selection context detection (Bug #2 fix)
# ATLAS_PENDING_SELECTION_CONTEXT=false

# Duplicate confirmation guard (Bug #1 fix)
# ATLAS_DUPLICATE_CONFIRMATION_GUARD=false

# Vehicle → Home/Garage routing (Bug #4 fix)
# ATLAS_VEHICLE_PILLAR_ROUTING=false

# Research error sanitization (Bug #5 fix)
# ATLAS_RESEARCH_ERROR_SANITIZATION=false

# ─── TUNING: DETECTION PARAMETERS ───────────────────────────────

# Pattern detection window (days, default: 14)
# ATLAS_PATTERN_WINDOW_DAYS=14

# Min occurrences to trigger skill proposal (default: 5)
# ATLAS_PATTERN_MIN_FREQUENCY=5

# Cooldown before re-proposing rejected patterns (hours, default: 24)
# ATLAS_PATTERN_COOLDOWN_HOURS=24

# ─── TUNING: SAFETY LIMITS ──────────────────────────────────────

# Max skills created per week (default: 5)
# ATLAS_SKILL_MAX_WEEKLY=5

# Max Tier 2 skills per week (default: 1)
# ATLAS_SKILL_MAX_TIER2_WEEKLY=1

# Auto-disable skill after N consecutive errors (default: 3)
# ATLAS_SKILL_AUTO_DISABLE_ERRORS=3

# Rollback window after deployment (hours, default: 24)
# ATLAS_SKILL_ROLLBACK_HOURS=24

# Max swarm dispatches per hour (default: 5)
# ATLAS_SWARM_MAX_PER_HOUR=5

# Swarm fix session timeout (seconds, default: 300)
# ATLAS_SWARM_TIMEOUT_SECONDS=300

# Self-improvement listener poll interval (ms, default: 60000)
# ATLAS_SELF_IMPROVEMENT_POLL_MS=60000

# ─── PATHS & LOGGING ────────────────────────────────────────────

# Working directory for Claude
CLAUDE_WORKING_DIR=./workspace

# Log level: debug | info | warn | error
LOG_LEVEL=info

# Audit log path
AUDIT_LOG_PATH=./logs

# Rate limiting
RATE_LIMIT_REQUESTS=30
RATE_LIMIT_WINDOW_SECONDS=60

# Session timeout (minutes)
SESSION_TIMEOUT_MINUTES=30

# ─── STATUS SERVER ───────────────────────────────────────────────

# Port for Chrome extension heartbeat server (default: 3847)
# STATUS_SERVER_PORT=3847
