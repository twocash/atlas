# ===========================================
# Atlas Telegram Bot - Environment Variables
# ===========================================
# Copy this file to .env and fill in your values

# -----------------
# REQUIRED
# -----------------

# Telegram Bot Token (from @BotFather)
TELEGRAM_BOT_TOKEN=1234567890:ABC-DEF1234ghIkl-zyx57W2v1u123ew11

# Your Telegram User ID (from @userinfobot)
# Comma-separated for multiple users
TELEGRAM_ALLOWED_USERS=123456789

# Notion Integration Token
# Create at: https://www.notion.so/my-integrations
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------
# CLAUDE AUTH
# -----------------
# Option 1: Use CLI auth (recommended)
# Just run `claude` once and authenticate

# Option 2: Use API key directly
# ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------
# PATHS
# -----------------

# Working directory for Claude (loads CLAUDE.md, SPARKS.md, etc.)
CLAUDE_WORKING_DIR=./workspace

# Paths Claude can access (comma-separated, overrides defaults)
# ALLOWED_PATHS=./workspace,~/.claude

# -----------------
# OPTIONAL
# -----------------

# OpenAI API key for voice transcription
# OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Google/Gemini API key for AI features
# Used by: web_search tool (Google Search grounding), research agent, media processor
# Get from: https://aistudio.google.com/app/apikey
GEMINI_API_KEY=AIza...

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Audit log path
AUDIT_LOG_PATH=./logs

# Rate limiting
RATE_LIMIT_REQUESTS=30
RATE_LIMIT_WINDOW_SECONDS=60

# Session timeout (minutes)
SESSION_TIMEOUT_MINUTES=30

# -----------------
# NOTION DATABASE IDs (CANONICAL - DO NOT CHANGE)
# -----------------
# Feed 2.0 (activity log) and Work Queue 2.0 (task ledger)
# Telegram IS the inbox - no separate inbox database
# These are DATABASE PAGE IDs for the Notion SDK
# NOTION_FEED_DB=90b2b33f-4b44-4b42-870f-8d62fb8cbf18
# NOTION_WORK_QUEUE_DB=3d679030-b76b-43bd-92d8-1ac51abb4a28

# Cognitive Router databases
NOTION_TOKEN_LEDGER_DB=6ec84319-8867-4aee-b55d-defe921c9f7b
NOTION_WORKER_RESULTS_DB=d886ee70-ab25-4388-acff-4314c77573b1

# ===========================================
# COGNITIVE ROUTER CONFIGURATION
# ===========================================

# -----------------
# API KEYS (Direct Access - Preferred)
# -----------------

# Anthropic API Key (for direct Claude access)
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# OpenAI API Key (for GPT models and JSON mode)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------
# FALLBACK AGGREGATOR
# -----------------

# OpenRouter API Key (fallback when direct APIs unavailable)
OPENROUTER_API_KEY=sk-or-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------
# COGNITIVE ROUTER SETTINGS
# -----------------

# Maximum concurrent workers (default: 5)
COGNITIVE_MAX_CONCURRENT_WORKERS=5

# Prefer direct API over OpenRouter (default: true)
COGNITIVE_PREFER_DIRECT_API=true

# Enable OpenRouter fallback (default: true)
COGNITIVE_OPENROUTER_FALLBACK=true

# Cost threshold for checkpoint (USD, default: 0.50)
COGNITIVE_COST_CHECKPOINT_THRESHOLD=0.50

# Circuit breaker max retries (default: 3)
COGNITIVE_MAX_RETRIES=3

# Enable cognitive router (default: false - uses legacy router)
USE_COGNITIVE_ROUTER=false

# ===========================================
# SKILL-CENTRIC ARCHITECTURE (Phase 1+)
# ===========================================

# -----------------
# FEATURE FLAGS
# -----------------

# Phase 1: Action Logging - logs all actions with intent hashes
ATLAS_SKILL_LOGGING=true

# Phase 2: Skill Execution - executes matched skills (enables contextual extraction)
ATLAS_SKILL_EXECUTION=true

# Phase 2: Hot Reload - watches skill files for changes
ATLAS_SKILL_HOT_RELOAD=false

# Phase 3: Pattern Detection - auto-proposes skills from patterns
ATLAS_PATTERN_DETECTION=false

# Phase 3: Auto-deploy Tier 0 - read-only skills deploy without approval
ATLAS_AUTO_DEPLOY_TIER0=false

# Phase 4: Skill Composition - skills can invoke other skills
ATLAS_SKILL_COMPOSITION=false

# -----------------
# DETECTION PARAMETERS (Phase 3)
# -----------------

# Pattern detection window (days, default: 14)
ATLAS_PATTERN_WINDOW_DAYS=14

# Minimum occurrences to trigger skill proposal (default: 5)
ATLAS_PATTERN_MIN_FREQUENCY=5

# Cooldown before re-proposing rejected patterns (hours, default: 24)
ATLAS_PATTERN_COOLDOWN_HOURS=24

# -----------------
# SAFETY LIMITS
# -----------------

# Maximum skills created per week (default: 5)
ATLAS_SKILL_MAX_WEEKLY=5

# Maximum Tier 2 skills per week (default: 1)
ATLAS_SKILL_MAX_TIER2_WEEKLY=1

# Auto-disable skill after consecutive errors (default: 3)
ATLAS_SKILL_AUTO_DISABLE_ERRORS=3

# Rollback window after deployment (hours, default: 24)
ATLAS_SKILL_ROLLBACK_HOURS=24

# ===========================================
# FAIL-FAST INFRASTRUCTURE
# ===========================================

# Atlas Mode: development or production
# Production CANNOT run with ENABLE_FALLBACKS=true (process.exit guard)
ATLAS_MODE=development

# Enable fallbacks for graceful degradation (MUST be false in production)
# When false: classification failures throw, research agents hard-fail, no silent fallbacks
ENABLE_FALLBACKS=true

# Auto-log errors to Dev Pipeline (default: true)
# P0/P1 errors also notify Telegram
AUTO_LOG_ERRORS=true

# ===========================================
# AUTONOMOUS REPAIR (Sprint: Pit Stop)
# ===========================================

# -----------------
# FEATURE FLAGS
# -----------------

# Self-healing pipeline flags — ALL default ON at startup.
# Uncomment any line below to DISABLE that component (safety valve).
#
# Zone classifier routes operations to auto-execute, auto-notify, or approve
# ATLAS_ZONE_CLASSIFIER=false
#
# Swarm dispatch spawns Claude Code sessions for autonomous fixes
# ATLAS_SWARM_DISPATCH=false
#
# Self-improvement listener polls Feed 2.0 for auto-repair entries
# ATLAS_SELF_IMPROVEMENT_LISTENER=false
#
# API swarm dispatch — uses Anthropic SDK directly instead of CLI
# ATLAS_API_SWARM=false

# -----------------
# SAFETY LIMITS
# -----------------

# Maximum swarm dispatches per hour (default: 5)
# Prevents runaway autonomous repair loops
ATLAS_SWARM_MAX_PER_HOUR=5

# Swarm fix session timeout (seconds, default: 300 = 5 min)
ATLAS_SWARM_TIMEOUT_SECONDS=300

# Self-improvement listener poll interval (ms, default: 60000 = 60 sec)
ATLAS_SELF_IMPROVEMENT_POLL_MS=60000
