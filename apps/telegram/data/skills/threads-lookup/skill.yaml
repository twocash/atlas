# Threads Post Lookup Skill - Browser-Based Extraction
# Tier 1: Uses Playwright for JavaScript-rendered content
# v5.0.0: Full browser extraction with pillar-aware analysis

name: threads-lookup
version: 5.0.0
description: Extract and analyze Threads posts using browser automation

triggers:
  - type: pattern
    value: "threads\\.(net|com)"
  - type: keyword
    value: "threads post"

inputs:
  url:
    type: string
    required: true
    description: Threads post URL
  pillar:
    type: string
    required: false
    description: Life domain (The Grove, Consulting, Personal, Home/Garage)
  depth:
    type: string
    required: false
    default: "standard"
    description: Extraction depth (shallow, standard, deep)
  feedId:
    type: string
    required: false
    description: Feed entry ID to update with extraction results
  workQueueId:
    type: string
    required: false
    description: Work Queue entry ID if applicable
  telegramChatId:
    type: number
    required: false
    description: Chat ID for sending completion notification

outputs:
  - type: feed_entry
    description: Enriched post content logged to Feed
  - type: data
    description: Extracted content and analysis

process:
  type: tool_sequence
  timeout: 90000
  steps:
    # Step 1: Open page in browser (handles JS rendering)
    - id: open_page
      tool: browser_open_page
      inputs:
        url: "$input.url"
        timeout: 30000
      onError: fail

    # Step 2: Extract text content
    - id: get_content
      tool: browser_get_text
      inputs:
        pageId: "$step.open_page.pageId"
      onError: continue

    # Step 3: Analyze content with Claude (pillar-aware)
    - id: analyze
      tool: claude_analyze
      inputs:
        content: "$step.get_content.output"
        systemPrompt: |
          Analyze this Threads post content. Extract:

          1. **Author**: Who posted this (username/handle if visible)
          2. **Main Message**: The core point or argument (2-3 sentences)
          3. **Key Insights**: Notable quotes, claims, or data points (bullet list)
          4. **Relevance**: How this relates to the user's "$input.pillar" domain
          5. **Suggested Actions**: 2-3 specific next steps the user could take

          Format your response with clear headers. Be concise but actionable.
          If the content is empty or unreadable, say so clearly.
      onError: continue

    # Step 4: Update Feed entry status
    - id: update_status
      tool: notion_update
      inputs:
        pageId: "$input.feedId"
        properties:
          Extraction Status: "complete"
          Extraction Depth: "$input.depth"
      onError: continue

    # Step 5: Append analysis to Feed page (follows SOP-007)
    - id: append_analysis
      tool: notion_append
      inputs:
        pageId: "$input.feedId"
        heading: "ðŸ§µ Threads Extraction"
        callout: "Pillar: $input.pillar | Depth: $input.depth | Source: Browser automation"
        calloutEmoji: "ðŸ“‹"
        content: "$step.analyze.output"
      onError: continue

    # Step 6: Notify user via Telegram
    - id: notify
      tool: telegram_send
      inputs:
        chatId: "$input.telegramChatId"
        message: |
          Threads extraction complete for $input.pillar

          $step.analyze.output
      onError: continue

    # Step 7: Close browser page (cleanup - always run)
    - id: cleanup
      tool: browser_close_page
      inputs:
        pageId: "$step.open_page.pageId"
      always_run: true
      onError: continue

enabled: true
tier: 1
tags:
  - social
  - threads
  - pillar-aware
  - contextual-extraction
  - browser-automation
